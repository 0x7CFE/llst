<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.1">
<title>Отчет по научной работе</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic|Noto+Serif:400,400italic,700,700italic|Droid+Sans+Mono:400">
<style>
/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
/* Remove the comments around the @import statement below when using this as a custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic|Noto+Serif:400,400italic,700,700italic|Droid+Sans+Mono:400";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em}
#content:before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
.sect1{padding-bottom:.625em}
@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}.sect1+.sect1{border-top:1px solid #efefed}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-check-square-o:first-child,ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.1.0/css/font-awesome.min.css">
</head>
<body class="article">
<div id="header">
<h1>Отчет по научной работе</h1>
<div id="toc" class="toc">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_Цели_работы">Цели работы</a></li>
<li><a href="#_О_проекте">О проекте</a>
<ul class="sectlevel2">
<li><a href="#_участие_в_проекте">участие в проекте</a></li>
<li><a href="#_Используемые_инструменты">Используемые инструменты</a></li>
</ul>
</li>
<li><a href="#_Описание_управления_памятью">Описание управления памятью</a>
<ul class="sectlevel2">
<li><a href="#_Заранее_реализованые_сборщики_мусора">Заранее реализованые сборщики мусора</a></li>
</ul>
</li>
<li><a href="#_Тесты">Тесты</a>
<ul class="sectlevel2">
<li><a href="#_Тесты_на_корректность">Тесты на корректность</a></li>
<li><a href="#_Стресс_тесты">Стресс-тесты</a></li>
</ul>
</li>
<li><a href="#_Выполнение_тестов">Выполнение тестов</a>
<ul class="sectlevel2">
<li><a href="#_Запуск">Запуск</a></li>
<li><a href="#_Анализ">Анализ</a></li>
</ul>
</li>
<li><a href="#_Результаты_тестов">Результаты тестов</a></li>
<li><a href="#_План_дальнейшей_работы">План дальнейшей работы</a></li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_Цели_работы">Цели работы</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Планируется реализовать одну из известных моделей сборщиков мусора в проекте LLST. В проекте уже имеется реализации системы сборки мусора. Таким образом необходимый результат - реализовать более эффективную модель для некоторого набора случаев. Эффективность реализации будет измеряться конкретным (описанным ниже) набором метрик при исполнении конкретного набора тестов. При этом допустим случай что не все метрики покажут хороший результат. В таком случае необходимо проанализировать применимость модели сборщика в различных общих случаях работы программ.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_О_проекте">О проекте</h2>
<div class="sectionbody">
<div class="paragraph">
<p>За основу научной работы был взят проект <strong>LLST</strong> выполняемый группой из 2х человек. Цель проекта: создание интерпретатора для языка Little Smalltalk (диалект Smalltalk). На данный момент интерпретатор совместим на уровне языка и уровне сгенированного байткода с описанием языка от его разработчика Timothy Budd. Возможности языка расширяются за счёт дополнения стандартной библиотеки и добавления новых примитивов (команд в байткоде), но при этом не ломается обратная совместимость. В плане синтаксиса Smalltalk-подобные языки очень просты (как например Lisp) и не нуждаются в дополнении.</p>
</div>
<div class="paragraph">
<p>Smalltalk специфичен тем, что вся разработка на нём ведётся в запущеной виртуальной машине. Чаще всего она представлена GUI, но есть и GNU-Smalltalk который работает в консоли. Накопленный результат работы можно сохранять в файловой системе в виде образов (image), которые в дальнейшем можно загружать. Все системы Smalltalk предоставляются программисту вместе со стартовым образом. Его можно считать стандартной библиотекой языка.</p>
</div>
<div class="paragraph">
<p>В проекте имеется виртуальная машина, которая представляет из себя интерпретатор и имеет консольный интерфейс в виде repl цикла (чтение команды, выполнения, вывода результата). Также есть компилятор начального образа. Описание начального образа пишется на языке Smalltalk, но имеет дополнительные лексемы. Начальный образ компилируется в байткод - который подаётся интерпретатору. Без начального образа нельзя запустить интурпретатор.</p>
</div>
<div class="paragraph">
<p>Разработка ведётся на языке C++. Также значительную долю кода занимает начальный образ на Little Smalltalk. Виртуальную машину сейчас можно (крос)скомпилировать под разные архитектура (x86, amd64, arm) и под разные ОС (Linux, Windows). В основном результат будет тестироваться Linux, x86.</p>
</div>
<div class="paragraph">
<p>Важной частью проекта является интеграция LLVM для реализации JIT-компилирования. Эта часть является отличительной по отношению к другим интерпретаторам языка Smalltalk.</p>
</div>
<div class="sect2">
<h3 id="_участие_в_проекте">участие в проекте</h3>
<div class="paragraph">
<p>Мною были сделаны некоторые изменения в коде интерпретатора. Большая часть из них это добавленные в текущие реализации сборщиков мусора методы по выводу текщуего состояния сборщика. По завершению работы системы выводится общая собранная информация.</p>
</div>
<div class="paragraph">
<p>Начальный образ написанный на Smalltalk был скопирован и переписан, чтобы добавить тесты отсносящиеся к сборщику мусора, также удалены тесты проверящие общую корректность интерпретатора.</p>
</div>
<div class="paragraph">
<p>Возможно также внести дополнительные примитивы, чтобы изнутри интерпретатора получать информацию о сборщике.</p>
</div>
<div class="paragraph">
<p>На данный момент моя работа никак не внесена в репозитории разработчиков проекта, так как не достигнуты конечные результаты.</p>
</div>
</div>
<div class="sect2">
<h3 id="_Используемые_инструменты">Используемые инструменты</h3>
<div class="paragraph">
<p>Данный документ описан в формате asciidoc и транслируется в html при помощи утилиты asciidoctor.</p>
</div>
<div class="paragraph">
<p>Для генерации отчета о тестах (в виде таблиц и графиков) используется скрипт написанный на python3 с использованием библиотеки svgwrite.</p>
</div>
<div class="paragraph">
<p>Информация о состоянии сборщика мусора регулярно записывается в файл (gc.log по умолчанию), формат которого имитирует формат OpenJDK. Что позволяет воспользоваться инфраструктурой java для анализа работы сборщика - имеется множество утилит для обработки данных лога сборщика. В частности была выбрана утилита gcviewer - она может построить график по работе и предоставить сводные данные по накопленому логу.</p>
</div>
<div class="paragraph">
<p>Также в процессе разработки используются g++, clang, gdb, valgrind, KDevelop, CLion, cmake (неважная информация. возможно и весь пункт не важен)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Описание_управления_памятью">Описание управления памятью</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Язык Smalltalk предполагает автоматическое упраление памятью. То есть виртуальную машину можно разделить на две части: та часть которая исполняет пользовательскую программу, за счёт выполнения команд изменяющих состояние (mutator) и часть осуществляющая выделение памяти при необходимости и при её завершении осуществляющая поиск и сборку не нужной памяти - сборщик (collector).</p>
</div>
<div class="paragraph">
<p>Задачи которые должен выполнять сборщик мусора:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Для нового объекта обязательно выделиться память (т.к. сборщик мусора - частный случай менеджера памяти)</p>
</li>
<li>
<p>В случае нехватки памяти все недостижимые объекты будут удалены</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Гарантии сборщика мусора:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ни один достижимый объект не будет удалён.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Для оценки производительности сборщика мусора были выбраны следующие параметры:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Общее время затраченное на выполнение теста (секунды) - включает в себя запуск и завершение работы виртуальной машины. Параметр зависит многих компонентов виртуальной машины и в том числе от сборщика мусора. По данному параметру можно судить об эффективности организации данных в памяти (локальность) при условии эффективных сборок (параметр ниже).</p>
</li>
<li>
<p>Общее время из gc.log - эта характеристика не исопльзуется в отчете, но есть в логе включает в себя время от запуска виртуальной машины до последней сборки.</p>
</li>
<li>
<p>Время потраченное на сборку (секунды) - параметр зависящий от кол-ва сборок и среднего времени. Один из основных параметров которые необходимо минимизировать.</p>
</li>
<li>
<p>количество сборок</p>
</li>
<li>
<p>количество аллокаций до сборки - среднее кол-во запросов на выделение памяти между сборками. Зависит от кол-ва сборок. Напрямую нам не интересен.</p>
</li>
<li>
<p>высвобождение памяти в минут</p>
</li>
<li>
<p>средняя длительность паузы</p>
</li>
<li>
<p>средний размер кучи - сама по себе не очень полезная величина. Вычисляется через численное интегрирование размера кучи по времени, затем полученная величина передаётся виртуальной машиной при завершении работы, затем мы делим на время работы и получаем среднее значение.  Интересно отношение размера кучи и неиспользуемого пространства кучи.</p>
</li>
<li>
<p>средний размер свободной памяти - вычисляется также как и средний размер кучи, но чаще (во время аллокации, а не во время увеличения размера).</p>
</li>
<li>
<p>процент эффективно занятой памяти - получаем из предыдущих двух парамметров</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_Заранее_реализованые_сборщики_мусора">Заранее реализованые сборщики мусора</h3>
<div class="paragraph">
<p>В проекте имеются написанные и протестированные сборщики.</p>
</div>
<div class="sect3">
<h4 id="_Копирующий_сборщик_мусора">Копирующий сборщик мусора</h4>
<div class="paragraph">
<p>Классический копирующий сборщик мусора. Выделяет память как минимум в 2 раза большую чем необходимо и делит её на две кучи активную и пассивную. Когда память заканчивается (не хватает памяти для аллокации объекта) происходит сборка:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Начинается поиск всех достижимых объектов</p>
</li>
<li>
<p>Достижимые объекты копируются в пассивную кучу</p>
</li>
<li>
<p>Указатели пассивной и активной кучи обмениваются</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Отдельно обрабатывается случай при котором после сборки всё равно не хватает места для аллокации объекта: начинается расширение кучи. Происходит выделение новой памяти (в полтора раза больше текущей). Происходит копирование в новую кучу. Память выделяется через realloc что может помочь в эффективности операции.</p>
</div>
<div class="paragraph">
<p>Известные проблемы сборщика:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Невозможно выделить большое количество памяти. Конкретнее: размер кучи может быть увеличен в полтора раза но не более.</p>
</li>
<li>
<p>Сборщик не уменьшает размер кучи (впрочем это редкая ситуация когда её необходимо уменьшать за исключением объектов-ресурсов, которые обычно выделяются и хранятся отдельно от общей кучи).</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_Копирующий_сборщик_llvm">Копирующий сборщик (LLVM)</h4>
<div class="paragraph">
<p>Наследуется от предыдущего. Всё аналогично предыдущему, но переопределён один метод, отвечающий за копирование объектов. Это может негативно сказаться на производительности, так как навешивается дополнительная логика. Но в тоже время jit-компиляция должна существенно ускорить работу программ.</p>
</div>
<div class="paragraph">
<p>Для проверки сборщиков мусора будут использованы тесты.</p>
</div>
</div>
<div class="sect3">
<h4 id="_Дефектные_сборщики_мусора">Дефектные сборщики мусора</h4>
<div class="paragraph">
<p>Также для тестов имеется несобирающий менеджер памяти - он только выделяет память в случае нехватки.
Одна из особенностей данного сборщика - он совсем не беспокоится о локальности данных. То есть фактически куча не увеличивается (через realloc и дальнейшее копирование в случае неуспеха), а просто создаётся новая с фиксированным размером.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Тесты">Тесты</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Тесты описаны в отдельном начальном образе. По своему предназначению их можно разделить на:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Проверяющие корректность (GCCorrectnessTest)</p>
</li>
<li>
<p>Проверяющие выполнение под нагрузкой (GCStressTest)</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Вторые являются подмножеством первых. Однако, если интерпретатор не справляется с первыми, то можно утверждать, что он не корректен (не выполняет заданные гарантии) и нуждается в исправлении. Это и есть цель тестов на корректность.</p>
</div>
<div class="paragraph">
<p>Если интерпретатор успешно справляется с первыми тестами, но не выполняет вторых, то здесь тоже уместно говорить о некорректности. При непрохождении тестов следует разобраться с причиной и по-возможности устранить найденые ошибки. Однако может оказаться, что сборщик неэффективно использует выделенный ему ресурс (оперативная память) и при достижении определенного порога считает невозможным продолжать работу. Такие ограничения для сборщиков допустимы.</p>
</div>
<div class="paragraph">
<p>Так как нагрузочные тесты предполагают работу с большим объёмом ресурсов, то потребуется продолжительное время (которое можно зафиксировать). У разных реализаций сборщика потребуется разное время, для работы с памятью (могут выделяться лишние объёмы памяти, либо неэффективный обход графа ссылок). Меньшие затраты времени и памяти будут говорить о большей эффективности реализации. Поэтому нагрузочные тесты преследуют следующие цели:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Проверить корректность (нельзя утверждать наверняка, но могут помочь при нахождении ошибок)</p>
</li>
<li>
<p>Найти ограничения сборщика (ситуации при которых сборщик соблюдает набор заданых гарантий, но не проходит тест)</p>
</li>
<li>
<p>Сравнить эффективность реализации сборщика.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Примером ограничений можно привести необходимость копирующего сборщика наличия памяти в 2 раза большей, чем память занимаемая реальными объектами. Подобное требование можно встретить во многих алгоритмах сборки. При этом требование описано из теоретических соображений. В действительности нам скорее всего потребуется ещё больший объём памяти, чтобы операционная система могла совершать манипуляции связаные с выделением памяти программе.</p>
</div>
<div class="paragraph">
<p>При реализации тестов возникнут следующие проблемы: во-первых к объектам, ссылка на которые утрачена нельзя обратиться из интерпритируемой программы (мутатора), во-вторых нельзя напрямую обратиться к сборщику мусору. Вторая проблема частично решена, т.к. можно вызвать <code>System collectGarbage</code>, который заставит сборщик выполнить сборку немедленно. Других методов для управления сборщиком не реализовано. Из-за этих проблем кажется более простым решением - создать тесты внутри компилятора. Но в таком случае перед нами встают другие проблемы: необходимо изнутри компилятора запустить строки (или зарнее заготовленную программу) на исполнение, дождаться завершения запустить сборщик и проверить его состояние. Проверка интерпретатора исходным кодом также проверяет и общую его работоспособность, хотя и затрудняет поиск ошибок.</p>
</div>
<div class="sect2">
<h3 id="_Тесты_на_корректность">Тесты на корректность</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Заполняем список значениями, вызываем сборщик мусора. Проверяем значения.</p>
</li>
<li>
<p>(LargeAlloc) создаём один огромный объект.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_Стресс_тесты">Стресс-тесты</h3>
<div class="paragraph">
<p>Первые два теста были взяты из проекта JikesRVM позже от них отказался, т.к. не совсем ясна их цель.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>(Exhaust) Будем поэтапно создавать массивы объектов, при этом на каждом этапе увеличивать размер массива в n раз. Из предыдущего массива ссылаться на новый и в конце каждого цикла терять ссылку на старый массив. В случае ошибки должно быть выведено сообщением с количеством памяти которое попыталась выделить программа.</p>
</li>
<li>
<p>(FixedLive) создаём дерево с заданым количеством элементов из объекта содержащего два целых числа и две ссылки car и cdr. Внутри дерева ссылки исходят только вниз (из старых элементов на новые), что обычно упрощает работу для сборщика.</p>
</li>
<li>
<p>Создание большого объекта (больше чем размер текущей кучи), затем его освобождение. Затем многократное создание малых объектов. Цель - убедиться в рациональности отведения памяти под кучу. Сборщик может не уменьшать размер кучи и из-за этого часть полезной занимаемой памяти будет ниже 10% в течении работы теста.</p>
</li>
<li>
<p>(list with holes) Создание списка следующим образом: добавляется элемент и создаётся массив из например 100 элементов, который тут же теряет ссылку. Таким образом список получается с пробелами которые можно устранить сборкой муссора. Затем над списком производятся операции (например представляем что это многомерный вектор и ищем его длину или просто сумма квадратов). На данный момент операции - это разворот списка и сортировка - получается худший случай для сортировки.</p>
</li>
<li>
<p>(list with arrays) То же самое, что 4 но ссылки не освобождаются. Таким образом можно проконтролировать - будет ли сборщик размещать объекты в порядке близости их достижения через ссылки.</p>
</li>
<li>
<p>(tree test) Создаём бинарное дерево с помощью массивов (т.к. массивы самая удобная структура для композиции объектов в языке). Дерево будет заполненым до заданной глубины. Затем обнуляем ссылки по определенному правилу - справа и слева обнулить правое поддерево и выполнить тоже самое в левом поддереве. Цель теста - проверить скорость работы сборщика в запутаных структурах данных. Это увеличит нагрузку на обход дерева и также может замедлить из-за мелких пробелов в структуре (если используем алгоритм Mark&amp;Compact).</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="tree_graph.png" alt="Бинарное дерево">
</div>
<div class="title">Figure 1. Иллюстрация дерева с глубиной 3</div>
</div>
</li>
<li>
<p>(tree with backlinks) Также создаём дерево, но в каждом узле добавляем по ссылке на каждого предка и соседа предка. Затем в каждом узле левого поддерева и корне обнуляем ссылку на правое поддерево. Таким образом нагрузка при обходе ссылок возможно немного возрастёт (хотя пройденные ссылки помечаются). Также этот тест можно запускать отдельно, чтобы посмотреть (убедиться) освобождает ли сборщик память при циклической структуре не имеющей ссылок из корневого множества.</p>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="tree_back_graph.png" alt="Бинарное дерево">
</div>
<div class="title">Figure 2. Иллюстрация дерева с обратными ссылками с глубиной 3</div>
</div>
</li>
<li>
<p>Создаём поток, который добавляет элементы в дерево, при этом создаёт ссылки из разных узлов. И поток, который удаляет все ссылки на заданный элемент. (не реализовано)</p>
</li>
<li>
<p>(diff) Реализация алгоритма для сравнения файлов подобного утилите diff из posix. Используется стандартный алгоритм с использованием методов динамического программирования. Данный тест имитирует обычную нагрзуку при работе с программой пользователя.</p>
</li>
<li>
<p>Не реализовано - diff через backtrace. Более интересный тест так как общепринятый алгоритм почти не создаёт нагрузки на память. Перебор с возвратом хоть и совсем не эффективен для утилиты diff, но вполне показателен в общем случае - так как зачастую эффективные алгоритмы либо не существуют, либо не известны программисту и приходится писать алгоритм с экспоненциальной сложностью и постоянным веделением памяти.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Выполнение_тестов">Выполнение тестов</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Для автоматического запуска тестов был написан скрипт на языке python. В нем находится список из пар [(название теста, строка вызывающая тест)] и список пар [(название сборщика, функция для сборки компилятора с указаным сборщиком)].</p>
</div>
<div class="paragraph">
<p>Скрипт проходится двойным циклом по каждому компоненту. Собирает информацию для каждой итерации и генерирует следующую структуру папок:</p>
</div>
<div class="listingblock">
<div class="content">
<pre> ├─ gcTest_image <i class="conum" data-value="1"></i><b>(1)</b>
 │  ├─ copy <i class="conum" data-value="2"></i><b>(2)</b>
 │  │  ├─ diff <i class="conum" data-value="3"></i><b>(3)</b>
 │  │  ├─ listWithArrays
 │  │  ├─ listWithHoles
 │  │  ├─ treeTest
 │  │  └─ treeTestWithBackLinks
 │  ├─ copy_LLVM <i class="conum" data-value="2"></i><b>(2)</b>
 │  │  ├─ diff <i class="conum" data-value="3"></i><b>(3)</b>
 │  │  ├─ listWithArrays
 │  │  ├─ listWithHoles
 │  │  ├─ treeTest
 │  │  └─ treeTestWithBackLinks</pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Корневая папка со скриптами для тестирования.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Папки для каждого сборщика мусора.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Папки для каждого теста. Содержат файлы - результаты проведения теста.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>и так далее для каждого сборщика. Внутри вложенных папок находится по 4 файла:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>gc.log</code> - лог сборщика подобный jvm</p>
</li>
<li>
<p><code>log.csv</code> - результат работы gcviewer: обработка <code>gc.log</code> и сборка суммарных характеристик</p>
</li>
<li>
<p><code>plot.png</code> - результат работы gcviewer: файл <code>gc.log</code> представленный визуально</p>
</li>
<li>
<p><code>stdout.log</code> - stdout во время теста (может пригодиться если тест не был пройден)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>В корневой папке также генерируется 3 файла, которые собирают выделеные выше характеристики основываясь на файлах выше.
* results.adoc - таблица в формате asciidoc, содержит характеристики по сборщику и группирует строки по тестам
* chart.svg - некоторые характеристики представленные в виде горизонтального графика
* thoughts.html - данный файл. Содержит предварительно описание написанное в файле thoughts.adoc и сгенерированное утилитой asciidoctor. Данное описание содержит места указывающие на 2 файла выше и в отдельности может использовать более детальное рассмотрение конкретных тестов.</p>
</div>
<div class="sect2">
<h3 id="_Запуск">Запуск</h3>
<div class="paragraph">
<p>Конфигурация компилятора с выбранным сборщиком каждый раз собирается отдельно. Из-за чего выполнение тестирования существенно замедляется. Это можно было бы немного ускорить за счет того чтобы хранить скомпилированные версии в разных папках и не пересобирать каждый раз, но пока что время запуска остаётся приемлемым (300с). Также время проведения тестирования в дальнейшем упирается в время самих тестов. Каждый тест по-своему конфигурируемый (например файл для diff, или высота дерева). Сейчас тесты составлены так, чтобы длительность их выполнения составляла несколько секунд (в пределеах десяти)</p>
</div>
</div>
<div class="sect2">
<h3 id="_Анализ">Анализ</h3>
<div class="paragraph">
<p>Известная особенность копирующего сборщика, то что у него есть 2 кучи одна из которых используется, а вторая простаивает. Из этого возникает проблема для сбора статистики: показывать ли в графиках незанятую кучу? С одной стороны это плохо, т.к. на графике для конкретного теста сделанному gc viewer по логам сборщика будет не очевидно, что в определенный момент занятая память достигла лишь половины и затем началась сборка (почему не полностью заполнилась). Однако в будущем будут другие варианты сборщиков с более (или менее) эффективным использованием памяти, тогда будет необходимо наглядное представление процента используемой памяти. Таким образом далее на всех графиках (таблицах) будем учитывать неактивную кучу.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Результаты_тестов">Результаты тестов</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
<col style="width: 10%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">Название</th>
<th class="tableblock halign-left valign-top">Всего затрачено времени (c)</th>
<th class="tableblock halign-left valign-top">время потраченное сборщиком (c)</th>
<th class="tableblock halign-left valign-top">количество сборок</th>
<th class="tableblock halign-left valign-top">кол-во аллокаций до сборки</th>
<th class="tableblock halign-left valign-top">высвобождение памяти в минуту</th>
<th class="tableblock halign-left valign-top">средняя длительность паузы (с)</th>
<th class="tableblock halign-left valign-top">средний размер кучи (кб)</th>
<th class="tableblock halign-left valign-top">средний размер свободной памяти (кб)</th>
<th class="tableblock halign-left valign-top">процент эффективно занятой памяти</th>
</tr>
</thead>
<tfoot>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">Название</p></th>
<td class="tableblock halign-left valign-top"><p class="tableblock">Всего затрачено времени (c)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">время потраченное сборщиком (c)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">количество сборок</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">кол-во аллокаций до сборки</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">высвобождение памяти в минуту</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">средняя длительность паузы (с)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">средний размер кучи (кб)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">средний размер свободной памяти (кб)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">процент эффективно занятой памяти</p></td>
</tr>
</tfoot>
<tbody>
<tr>
<th class="tableblock halign-center valign-top" colspan="10" style="background-color: navy;"><p class="tableblock"><span class="white">listWithArrays</span></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">copy_LLVM</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">9.49</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1.38</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">276</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">25443</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1 531,735 M</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.00501</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">5362.84</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">2212.45</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.59</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">copy</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">22.2</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">5.8</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">276</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">25443</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">674,944 M</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.021</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">5133.22</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">2719.03</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.47</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">non_collecting</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">16.8</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.28</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">724</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">9699</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0 B</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">3.90e-04</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1.14e+05</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">171.277</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="10" style="background-color: navy;"><p class="tableblock"><span class="white">treeTestWithBackLinks</span></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">copy_LLVM</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">8.91</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1.67</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">374</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">16205</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1 442,283 M</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.00446</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">3318.79</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1427.53</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.57</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">copy</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">23.3</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">7.72</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">374</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">16205</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">566,959 M</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.0207</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">3264.99</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1819.75</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.44</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">non_collecting</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">16.0</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.25</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">644</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">9411</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0 B</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">3.90e-04</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1.01e+05</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">175.309</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="10" style="background-color: navy;"><p class="tableblock"><span class="white">diff</span></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">copy_LLVM</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">7.62</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.11</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">473</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">13883</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1 805,893 M</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">2.30e-04</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1018.12</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">428.875</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.58</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">copy</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">15.0</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.24</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">473</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">13883</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">960,409 M</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">5.10e-04</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1021.19</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">556</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.46</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">non_collecting</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">15.1</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.27</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">692</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">9490</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0 B</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">3.90e-04</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1.09e+05</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">175.262</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="10" style="background-color: navy;"><p class="tableblock"><span class="white">listWithHoles</span></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">copy_LLVM</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">9.15</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1.09</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">308</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">22789</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1 589,983 M</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.00355</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">4929.96</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">2003.67</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.59</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">copy</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">21.2</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">4.89</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">308</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">22789</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">708,603 M</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.0159</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">4719.71</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">2485.79</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.47</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">non_collecting</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">16.7</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.28</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">724</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">9695</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0 B</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">3.90e-04</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1.14e+05</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">171.659</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1.0</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" colspan="10" style="background-color: navy;"><p class="tableblock"><span class="white">treeTest</span></p></th>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">copy_LLVM</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">3.3</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.5</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">199</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">11820</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1 523,904 M</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.0025</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">2004.96</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">843.908</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.58</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">copy</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">8.09</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">2.1</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">199</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">11820</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">675,831 M</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.0106</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1954.09</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">1086.11</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.44</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top" style="background-color: white;"><p class="tableblock">non_collecting</p></th>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">6.1</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.09</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">242</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">9721</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0 B</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">3.90e-04</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">33503.2</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">260.209</p></td>
<td class="tableblock halign-left valign-top" style="background-color: white;"><p class="tableblock">0.99</p></td>
</tr>
</tbody>
</table>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="chart_with_nc.svg" alt="Общий график">
</div>
<div class="title">Figure 3. Общий график</div>
</div>
<div class="paragraph">
<p>Во-первых с самого начала составления тестов было замечено, что ни один менеджер памяти не в состоянии выделить память для большого объекта (как минимум в полтора раза больше текущего размера кучи). Как оказалось это известный баг компилятора и пока что этот тест был исключен. В дальнейшем с моей стороны потребуется его исправить в существующих сборщиках.</p>
</div>
<div class="paragraph">
<p>Если взглянуть на первую колонку (столбцов) диаграммы то можно увидеть общую тенденцию: наибыстрейшее решение здесь виртуальная машина собранная с JIT компилятором. В общем это ключевой момент проекта, многие поставленные цели достигнуты и методы смолтолка компилируются в нативный код. Очевидный прирост скорости выполнения. На втором месте по скорости оказывается менеджер не являющийся сборщиком. Здесь результат не такой очевидный и из него можно заключить, что на время сборки тратится существенное время</p>
</div>
<div class="paragraph">
<p>По третьей колонке можно заметить, что сборка в "нормальных" сборщиках гораздо дольше, чем в non-collecting. Это можно понять, т.к. в случае non-collecting все время занимает выделение памяти. А в случае полноценной копирующей сборки там может выделение памяти + проверка достижимости объекта + копирование каждого объекта с одной кучи в другую. Однако в случае diff теста время сборки соизмеримо. Так произошло из-за особенности теста: однажды прочитав файл памяти в кучи не добавляется, за исключением временных переменных на каждой итерации. В этом можно убедиться посмотрев на график сгенерированный по логам сборки копирующего сборщика во время теста diff. Также можно обратить внимание на масштаб шкалы: все величину порядка 10 в -4й степени.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="plot_copy_diff.png" alt="Сгенерированный графикам по логам copy сборщика для теста diff">
</div>
<div class="title">Figure 4. Сгенерированный графикам по логам copy сборщика для теста diff</div>
</div>
<div class="paragraph">
<p>Так выглядят графики сгенерированные программой GCViewer. Область закрашенная красным обозначает общий размер кучи. Синяя линия обозначает занятую область памяти (сборки происходят на пиках синей линии).</p>
</div>
<div class="paragraph">
<p>Во всех тестах лог сборки для non_collecting выглядит примерно одинаково:</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="plot_non_collecting_diff.png" alt="Сгенерированный графикам по логам non-collecting сборщика для теста diff">
</div>
<div class="title">Figure 5. Сгенерированный графикам по логам non-collecting сборщика для теста diff</div>
</div>
<div class="paragraph">
<p>С такого масштаба график кажется простой линейной функцией, т.к. куча увеличивается на фиксированный размер. Занятое пространство растет линейно, т.к. в алгоритме повторяются одинаковые итерации.</p>
</div>
<div class="paragraph">
<p>В основном non_collecting менеджер памяти был необходим для того чтобы проверить тесты на их адекватность. Т.к. есть некоторые ожидания к менеджеру который совсем не совершает очищение памяти. Например по второму столбцу можно заметить, что такой менеджер потребляет гораздо больше памяти, что соответствует ожиданиям. Теперь же когда ожидания оправдались его можно убрать среди тестируюмых сборщиков и оставить только 2.</p>
</div>
<div class="imageblock" style="text-align: center">
<div class="content">
<img src="chart.svg" alt="Общий график">
</div>
<div class="title">Figure 6. Общий график</div>
</div>
<div class="paragraph">
<p>Здесь можно увидеть во втором столбце, что сборщики примерно одинаково потребляют память (хотя в конфигурации с JIT-компилятором все же немного больше, что я затрудняюсь прокомментировать). В третьем столбце можно заметить (ещё с первоначального графика), что copy_LLVM примерно в два раза быстрее совершает сборку. Что на первый взгляд может показаться необъяснимым - ведь сборщики работают с одинаковым алгоритмом. Даже если посмотреть в код сборщика можно заметить что в конфигурации с LLVM сборщика, только добавляются дополнительные проверки при копировании объектов но не более того.</p>
</div>
<div class="paragraph">
<p>На самом деле этому есть объяснение. В обоих сборщиках объекты создаются в одинаковых кучах. Однако в случае работы LLVM указатели на аргументы функции кладутся не в общее дерево ссылок, а в реальный машинный стек. Таким образом память заполняется у обоих сборщиком примерно одинаково, но в случае работы LLVM дерево ссылок получается заметно меньше и обход для проверки достижимости уменьшается. Здесь также сказывается особенность Smalltalk&#8217;а: высокая плотность вызова методов, почти как в функциональных языках. В языке мало встроенных конструкций (присваивание, передача параметра, вызов метода) и циклы, условия заменены вызовами анонимных блоков кода.</p>
</div>
<div class="paragraph">
<p>Правда выходит, что во время сборки аргументы функции могут пропасть - этот момент учтён разработчиками.</p>
</div>
<div class="paragraph">
<p>Характеристики "количество сборок" и "(среднее) количество аллокаций до сборки" нам здесь не о чем не говорят - они получились на удивление схожими у версии с JIT компиляцией и без неё. Если сравнивать с non-collecting то всё выглядит довольно естественно. У non-collecting больше так называемых сборок (увеличения памяти), при этом аллокаций меньше, т.к. он аллоцирует каждый раз одинаковое количество памяти.</p>
</div>
<div class="paragraph">
<p>Можно посмотреть на различие работы в разных тестах например тесты listWithArrays и listWithHoles. Во втором ссылки на массивы тут же теряются из-за чего затрачиваемая память и время работы должно быть меньше. Можно сказать, что действительно разница есть в таблице можно заметить эффект при том что количество сборок больше. Однако ожидается экономия памяти примерно 10кратная в случае второго теста.</p>
</div>
<div class="paragraph">
<p>Тест "treeTestWithBackLinks" имеет больший показатель "время потраченое сборщиком", при меньшем показателе "средний размер кучи", по сравнению с тестами со списками. Таким образом тест подходит для сравнения длительности обхода графа.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_План_дальнейшей_работы">План дальнейшей работы</h2>
<div class="sectionbody">
<div class="paragraph">
<p>В будущем будет необходимо сделать ещё пару тестов (они планировались ранее). Во первых алгоритм diff на основе полного перебора. В реальных решениях пользователи зачастую склонны делать алгоритмы с экспоненциальным (или полимиальным) ростом памяти, до тех пор пока возможности машины позволяют решать задачи предметной области.</p>
</div>
<div class="paragraph">
<p>Во-вторых тест показывающий беспрерывную работу со случайным ростом памяти (переменно убывающим\возростающим требованием к памяти). Это достаточно жизненный пример - gui приложение, либо сервер. Сервер сделать представляется затруднительным ввиду нынешних возможностей стандартной библиотеки. Например можно сделать скрипт, который запускает lynx с каким-нибудь корневым адресом в сети, затем парсит встречающиеся ссылки на сайте и переходит на ссылки с внутренним доменом пройденные ссылки добавляются в множество и это продолжаются до тех пор пока не останется ссылок не из множества. Полученную связь переходов записать в dot файл для того чтобы построить граф переходов. Задача звучит переусложненной для тестовой. Но работа теста будет наглядна (например в блогах связь очевидна) и основное время будет тратиться на работу с сетью.</p>
</div>
<div class="paragraph">
<p>Также возможно понадобится отображение результатов тестов для двух сборщиков - чтобы при внесении малых оптимизаций смотреть изменения тестов (можно обойтись текущим представлением, можно сделать более удобную таблицу).</p>
</div>
<div class="paragraph">
<p>Сейчас основной моделью выбрана Generational - сборщик мусора, разделяющий объекты в разные кучи в зависимости от времени жизни объекта. Здесь есть набор параметров таких как размер каждой кучи, которые могут существенно сказаться на производительности сборщика. Начальный размер необходимо задать статически и в последующем его изменять. Правила изменения и начальный размер - являются своей областью исследования. Возможно необходимо найти данные из (возможно имеющихся) источников либо самостоятельно собрать статистику из схожих языков программирования и сделать заключения.</p>
</div>
<div class="paragraph">
<p>Кроме того в процессе написания сборщика есть побочные оптимизации которые почти не зависят от выбранной модели: во-первых можно сделать отдельную кучу для больших объектов, во-вторых можно реализовать паралельный обход графа объектов.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2015-01-28 17:16:52 MSK
</div>
</div>
</body>
</html>